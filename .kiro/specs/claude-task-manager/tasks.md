# 実装計画

- [ ] 1. プロジェクト基盤とMCPサーバーの基本構造を構築
  - TypeScriptプロジェクトの初期化とMCP SDKの統合
  - 基本的なサーバー構造とツール登録システムの実装
  - _要件: 1.1, 1.2, 7.1, 7.2_

- [ ] 2. 設定管理システムの実装
- [ ] 2.1 設定ファイルの読み書き機能を実装
  - ~/.sage/config.jsonの読み込み・保存機能
  - 設定ファイルの存在確認とバリデーション
  - _要件: 1.1, 1.5, 10.1_

- [ ] 2.2 設定値検証システムを実装
  - 設定項目の型チェックと形式検証
  - 必須項目の存在確認とデフォルト値設定
  - _要件: 10.2, 10.3, 10.6_

- [ ] 3. セットアップウィザードの実装
- [ ] 3.1 セットアップ状態確認機能を実装
  - check_setup_statusツールの実装
  - 設定ファイルの存在と完全性チェック
  - _要件: 1.1, 1.6_

- [ ] 3.2 対話的セットアップウィザードを実装
  - start_setup_wizardツールの実装
  - 10問の質問フローとセッション管理
  - _要件: 1.3, 1.4_

- [ ] 3.3 ウィザード質問応答システムを実装
  - answer_wizard_questionツールの実装
  - 回答の検証と次の質問への遷移ロジック
  - _要件: 1.3, 1.4_

- [ ] 3.4 設定保存機能を実装
  - save_configツールの実装
  - ウィザード完了時の設定ファイル生成
  - _要件: 1.4, 1.5, 1.6_

- [ ] 4. タスク分割エンジンの実装
- [ ] 4.1 複数タスク分離機能を実装
  - 一つの文章から複数のタスクを識別・分離
  - タスク境界の検出とタスクリスト生成
  - _要件: 11.1, 11.4_

- [ ] 4.2 大きなタスクの分割機能を実装
  - 複雑なタスクのサブタスク分解
  - 実行可能な単位への分割ロジック
  - _要件: 11.2, 11.3_

- [ ] 4.3 タスク依存関係と順序付けを実装
  - 分割されたタスク間の依存関係分析
  - 推奨実行順序の決定とユーザーへの説明
  - _要件: 11.5, 11.6_

- [ ] 5. 優先度判定エンジンの実装
- [ ] 5.1 基本優先度ルールエンジンを実装
  - P0-P3の優先度判定ロジック
  - 設定ベースの条件評価システム
  - _要件: 2.1, 2.2, 2.5_

- [ ] 5.2 期限ベース優先度判定を実装
  - 期限キーワードの検出と緊急度評価
  - 24時間、3日、1週間などの期限しきい値処理
  - _要件: 2.3_

- [ ] 5.3 関係者ベース優先度判定を実装
  - マネージャーや重要な関係者の検出
  - 関係者に基づく優先度調整
  - _要件: 2.4_

- [ ] 6. 時間見積もりシステムの実装
- [ ] 6.1 キーワードベース時間見積もりを実装
  - タスク内容からのキーワード抽出
  - 複雑度に基づく時間見積もりアルゴリズム
  - _要件: 3.1, 3.2, 2.6_

- [ ] 6.2 見積もり精度向上機能を実装
  - ユーザーフィードバックによる学習機能
  - 個人の作業パターンに基づく調整
  - _要件: 3.1, 3.2_

- [ ] 7. 関係者抽出システムの実装
- [ ] 7.1 基本関係者抽出機能を実装
  - タスク内容からの関係者名抽出
  - 設定されたチームメンバーとのマッチング
  - _要件: 4.1, 4.2_

- [ ] 7.2 @メンション検出機能を実装
  - @記号付きメンションの検出と抽出
  - メンション形式の正規化処理
  - _要件: 4.3_

- [ ] 7.3 マネージャー検出機能を実装
  - マネージャーキーワードの検出
  - マネージャー関与のフラグ付け
  - _要件: 4.4, 4.5_

- [ ] 8. タスク分析統合システムの実装
- [ ] 8.1 analyze_tasksツールを実装
  - 全分析機能を統合したメインツール
  - 優先度、時間、関係者の包括的分析
  - _要件: 2.1, 2.5, 2.6_

- [ ] 8.2 分析結果フォーマット機能を実装
  - 分析結果の構造化と理由説明
  - ユーザーフレンドリーな結果表示
  - _要件: 2.5_

- [ ] 9. Apple Reminders統合の実装
- [ ] 9.1 AppleScript統合基盤を実装
  - node-applescriptを使用したApple Reminders連携
  - AppleScriptコマンドの実行とエラーハンドリング
  - _要件: 9.2_

- [ ] 9.2 リマインダー作成機能を実装
  - 7日以内のタスクのApple Reminders作成
  - 適切な期限日とアラーム設定
  - _要件: 9.1, 9.4_

- [ ] 9.3 リマインダーリスト管理を実装
  - 設定されたリマインダーリストへの振り分け
  - リスト選択ロジックの実装
  - _要件: 9.3_

- [ ] 10. Notion統合の実装
- [ ] 10.1 Notion API基盤を実装
  - @notionhq/clientを使用したNotion連携
  - API認証とエラーハンドリング
  - _要件: 8.2_

- [ ] 10.2 Notionページ作成機能を実装
  - 8日以上先のタスクのNotionページ作成
  - タイトル、優先度、期限、関係者の設定
  - _要件: 8.1, 8.3_

- [ ] 10.3 Notion同期結果処理を実装
  - 作成成功時のページURL返却
  - 同期失敗時のエラー詳細提供
  - _要件: 8.4, 8.5_

- [ ] 11. Google Calendar統合の実装
- [ ] 11.1 Google Calendar API基盤を実装
  - googleapis使用したカレンダー連携
  - API認証とイベント取得機能
  - _要件: 6.1_

- [ ] 11.2 空き時間検出機能を実装
  - カレンダーイベントと空き時間の分析
  - 勤務時間内での利用可能時間枠検出
  - _要件: 6.2, 6.5_

- [ ] 11.3 作業適合度評価機能を実装
  - 深い作業日vs会議の多い日の考慮
  - 時間枠の適合度ランキング
  - _要件: 6.3, 6.4, 6.6_

- [ ] 11.4 find_available_slotsツールを実装
  - カレンダー統合機能のメインツール
  - 推奨時間枠の提案と理由説明
  - _要件: 3.3, 3.4, 3.5, 3.6_

- [ ] 12. リマインド管理システムの実装
- [ ] 12.1 リマインド振り分けロジックを実装
  - 期限に基づくApple Reminders/Notion振り分け
  - 7日/8日しきい値での自動判定
  - _要件: 5.2, 5.3_

- [ ] 12.2 set_reminderツールを実装
  - リマインド設定のメインツール
  - 適切なサービスへの自動振り分け
  - _要件: 5.1, 5.4, 5.5, 5.6_

- [ ] 12.3 リマインド時間計算機能を実装
  - 設定に基づく適切なリマインド時間算出
  - 複数リマインドタイプの対応
  - _要件: 5.1, 5.4_

- [ ] 13. sync_to_notionツールの実装
- [ ] 13.1 Notion同期メインツールを実装
  - 長期タスクのNotion同期機能
  - タスク情報の適切なマッピング
  - _要件: 8.1, 8.2, 8.3_

- [ ] 13.2 同期エラーハンドリングを実装
  - API制限やネットワークエラーの処理
  - ユーザーフレンドリーなエラーメッセージ
  - _要件: 8.5_

- [ ] 14. 設定更新システムの実装
- [ ] 14.1 update_configツールを実装
  - 既存設定の部分更新機能
  - セクション別の設定変更対応
  - _要件: 10.1_

- [ ] 14.2 設定検証機能を実装
  - 更新時の設定値検証
  - API接続テストと形式チェック
  - _要件: 10.2, 10.3, 10.4_

- [ ] 14.3 設定変更確認機能を実装
  - 更新成功の確認メッセージ
  - 検証失敗時の具体的エラー表示
  - _要件: 10.5, 10.6_

- [ ] 15. エラーハンドリングとロバストネスの実装
- [ ] 15.1 統一エラーハンドリングシステムを実装
  - 全ツール共通のエラー処理機構
  - エラー分類と適切なメッセージ生成
  - _要件: 5.6, 8.5, 9.5_

- [ ] 15.2 リトライ機構を実装
  - ネットワークエラーや一時的障害の自動リトライ
  - 指数バックオフによるリトライ間隔制御
  - _要件: 5.6, 8.5_

- [ ] 15.3 グレースフルデグラデーション機能を実装
  - 一部機能失敗時の他機能継続動作
  - 代替手段の提案機能
  - _要件: 7.3, 7.4, 7.5_

- [ ] 16. クロスプラットフォーム対応の実装
- [ ] 16.1 Claude Desktop用manifest.jsonを作成
  - MCPBパッケージング用のマニフェスト
  - 環境変数設定とエントリーポイント定義
  - _要件: 7.1, 7.4_

- [ ] 16.2 Claude Code用marketplace.jsonを作成
  - プラグインマーケットプレイス用設定
  - 同一機能の両プラットフォーム提供
  - _要件: 7.2, 7.4_

- [ ] 16.3 両プラットフォーム互換性テストを実装
  - Desktop/Code両環境での動作確認
  - 同一設定ファイル使用の検証
  - _要件: 7.3, 7.4, 7.5_

- [ ] 17. 包括的テストスイートの実装
- [ ] 17.1 ユニットテストを実装
  - 各コンポーネントの単体テスト
  - 優先度判定、時間見積もり、関係者抽出のテスト
  - _要件: 全要件の検証_

- [ ] 17.2 統合テストを実装
  - 外部API統合のテスト
  - エラーハンドリングとリトライ機構のテスト
  - _要件: 5.5, 5.6, 8.4, 8.5, 9.4, 9.5_

- [ ] 17.3 E2Eテストを実装
  - セットアップから分析、リマインド作成までの完全フロー
  - 実際のユーザーシナリオの検証
  - _要件: 1.1-1.6, 2.1-2.6, 5.1-5.6_

- [ ] 18. ドキュメントとデプロイメント準備
- [ ] 18.1 ユーザードキュメントを作成
  - README.mdとセットアップガイド
  - 機能説明と使用例
  - _要件: 1.3, 1.6_

- [ ] 18.2 開発者ドキュメントを作成
  - API仕様とアーキテクチャ説明
  - 拡張とカスタマイズガイド
  - _要件: 全要件の実装ガイド_

- [ ] 18.3 配布パッケージを作成
  - MCPBファイルとプラグインパッケージの生成
  - インストールテストと配布準備
  - _要件: 7.1, 7.2_