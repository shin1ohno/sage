# ãƒ‡ã‚¶ã‚¤ãƒ³æ–‡æ›¸

## æ¦‚è¦

sageã¯ã€Claude Desktopã€Claude Codeã€ãŠã‚ˆã³Claude iOS/iPadOSå‘ã‘ã®AIã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚å€‹äººã®ä½œæ¥­ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã€ã‚¿ã‚¹ã‚¯ã®åˆ†æã€å„ªå…ˆé †ä½ä»˜ã‘ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã€ãƒªãƒã‚¤ãƒ³ãƒ‰ç®¡ç†ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚

### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£…çŠ¶æ³

| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | çŠ¶æ…‹ | å®Ÿè£…æ–¹å¼ | æ©Ÿèƒ½ãƒ¬ãƒ™ãƒ« |
|----------------|------|---------|-----------|
| **Claude Desktop/Code** | âœ… å®Ÿè£…æ¸ˆã¿ | Local MCPã‚µãƒ¼ãƒãƒ¼ | å®Œå…¨æ©Ÿèƒ½ |
| **Claude iOS/iPadOS** | âœ… **Remote MCPå¯¾å¿œ** | Remote MCPã‚µãƒ¼ãƒãƒ¼ | å®Œå…¨æ©Ÿèƒ½ |
| **Claude Web** | âœ… **Remote MCPå¯¾å¿œ** | Remote MCPã‚µãƒ¼ãƒãƒ¼ | å®Œå…¨æ©Ÿèƒ½ |

### Remote MCPå¯¾å¿œã®åˆ©ç‚¹

**iOS/iPadOS/Webç‰ˆã§ã®å®Œå…¨æ©Ÿèƒ½æä¾›:**
- âœ… ã™ã¹ã¦ã®sageæ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- âœ… å¤–éƒ¨çµ±åˆï¼ˆApple Remindersã€Notionã€Calendarï¼‰
- âœ… æ°¸ç¶šçš„ãªè¨­å®šç®¡ç†
- âœ… é«˜åº¦ãªã‚¿ã‚¹ã‚¯åˆ†æã¨TODOãƒªã‚¹ãƒˆç®¡ç†
- âœ… OAuthèªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ©ç‚¹:**
- å˜ä¸€ã®ã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ã§å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®è¨­å®šåŒæœŸ
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªå±•é–‹
- çµ±ä¸€ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“

ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã¾ã™ï¼š
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ï¼ˆåˆå›è¨­å®šï¼‰
- ã‚¿ã‚¹ã‚¯åˆ†æã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆå„ªå…ˆåº¦ãƒ»æ™‚é–“è¦‹ç©ã‚‚ã‚Šãƒ»é–¢ä¿‚è€…æŠ½å‡ºï¼‰
- ã‚¿ã‚¹ã‚¯åˆ†å‰²ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆè¤‡é›‘ã‚¿ã‚¹ã‚¯ã®åˆ†è§£ï¼‰
- å¤–éƒ¨çµ±åˆï¼ˆApple Remindersã€Notionã€Google Calendarï¼‰
- è¨­å®šç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é©å¿œãƒ¬ã‚¤ãƒ¤ãƒ¼

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Claude Client                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Desktop/Code â”‚iOS/iPadOS   â”‚Web              â”‚ â”‚
â”‚  â”‚(Local MCP)  â”‚(Remote MCP) â”‚(Remote MCP)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚ HTTPS/WSS
       â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Local MCP      â”‚  â”‚     Remote MCP Server       â”‚
â”‚  sage Server    â”‚  â”‚     (Cloud Hosted)          â”‚
â”‚                 â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  - File Config  â”‚  â”‚  â”‚    HTTP/WebSocket       â”‚ â”‚
â”‚  - AppleScript  â”‚  â”‚  â”‚    Transport Layer      â”‚ â”‚
â”‚  - Direct APIs  â”‚  â”‚  â”‚  - OAuth Authentication â”‚ â”‚
â”‚                 â”‚  â”‚  â”‚  - Rate Limiting        â”‚ â”‚
â”‚                 â”‚  â”‚  â”‚  - Request Validation   â”‚ â”‚
â”‚                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                 â”‚  â”‚  â”‚   sage Core Engine      â”‚ â”‚
â”‚                 â”‚  â”‚  â”‚  - Task Analysis        â”‚ â”‚
â”‚                 â”‚  â”‚  â”‚  - TODO Management      â”‚ â”‚
â”‚                 â”‚  â”‚  â”‚  - External Integrationsâ”‚ â”‚
â”‚                 â”‚  â”‚  â”‚  - User Config Storage  â”‚ â”‚
â”‚                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    External Services        â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                     â”‚  â”‚  Apple Reminders API    â”‚ â”‚
                     â”‚  â”‚  (via iCloud Web API)   â”‚ â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                     â”‚  â”‚     Notion API          â”‚ â”‚
                     â”‚  â”‚  (Direct Integration)   â”‚ â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                     â”‚  â”‚   Calendar APIs         â”‚ â”‚
                     â”‚  â”‚  (Google/Outlook/iCloud)â”‚ â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥æ©Ÿèƒ½æ¯”è¼ƒ

| æ©Ÿèƒ½ | Desktop/Code (Local MCP) | iOS/iPadOS (Remote MCP) | Web (Remote MCP) |
|------|-------------------------|------------------------|------------------|
| ã‚¿ã‚¹ã‚¯åˆ†æ | âœ… å®Œå…¨ç‰ˆ | âœ… å®Œå…¨ç‰ˆ | âœ… å®Œå…¨ç‰ˆ |
| å„ªå…ˆé †ä½ä»˜ã‘ | âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« | âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« | âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« |
| æ™‚é–“è¦‹ç©ã‚‚ã‚Š | âœ… å­¦ç¿’æ©Ÿèƒ½ä»˜ã | âœ… å­¦ç¿’æ©Ÿèƒ½ä»˜ã | âœ… å­¦ç¿’æ©Ÿèƒ½ä»˜ã |
| ã‚¿ã‚¹ã‚¯åˆ†å‰² | âœ… è¤‡é›‘ãªåˆ†å‰² | âœ… è¤‡é›‘ãªåˆ†å‰² | âœ… è¤‡é›‘ãªåˆ†å‰² |
| TODOãƒªã‚¹ãƒˆç®¡ç† | âœ… å®Œå…¨ç‰ˆ | âœ… å®Œå…¨ç‰ˆ | âœ… å®Œå…¨ç‰ˆ |
| è¨­å®šç®¡ç† | âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ« | âœ… ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ | âœ… ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ |
| Apple Reminders | âœ… AppleScript | âœ… iCloud Web API | âœ… iCloud Web API |
| Calendarçµ±åˆ | âœ… AppleScript | âœ… Web APIs | âœ… Web APIs |
| Notionçµ±åˆ | âœ… MCPçµŒç”± | âœ… Direct API | âœ… Direct API |
â”‚  â”‚  - ConfigValidator                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Core Analysis Layer             â”‚  â”‚
â”‚  â”‚  - TaskSplitter                           â”‚  â”‚
â”‚  â”‚  - TaskAnalyzer                           â”‚  â”‚
â”‚  â”‚  - PriorityEngine                         â”‚  â”‚
â”‚  â”‚  - TimeEstimator                          â”‚  â”‚
â”‚  â”‚  - StakeholderExtractor                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Integration Layer                  â”‚  â”‚
â”‚  â”‚  - ReminderManager                        â”‚  â”‚
â”‚  â”‚  - CalendarService                        â”‚  â”‚
â”‚  â”‚  - NotionMCPService (Desktop/Code only)   â”‚  â”‚
â”‚  â”‚  - AppleRemindersService                  â”‚  â”‚
â”‚  â”‚  - NativeIntegrationService (iOS/iPadOS)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Configuration Storage              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Desktop/Code â”‚iOS/iPadOS   â”‚Web              â”‚ â”‚
â”‚  â”‚~/.sage/     â”‚Session +    â”‚Session Only     â”‚ â”‚
â”‚  â”‚config.json  â”‚iCloud Sync  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥æ©Ÿèƒ½æ¯”è¼ƒ

| æ©Ÿèƒ½ | Desktop/Code (MCP) | iOS/iPadOS (Skills) | Web (Skills) |
|------|-------------------|-------------------|--------------|
| ã‚¿ã‚¹ã‚¯åˆ†æ | âœ… å®Œå…¨ç‰ˆ | ğŸ”® å°†æ¥å¯¾å¿œ | ğŸ”® å°†æ¥å¯¾å¿œ |
| å„ªå…ˆé †ä½ä»˜ã‘ | âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« | ğŸ”® å°†æ¥å¯¾å¿œ | ğŸ”® å°†æ¥å¯¾å¿œ |
| æ™‚é–“è¦‹ç©ã‚‚ã‚Š | âœ… å­¦ç¿’æ©Ÿèƒ½ä»˜ã | ğŸ”® å°†æ¥å¯¾å¿œ | ğŸ”® å°†æ¥å¯¾å¿œ |
| ã‚¿ã‚¹ã‚¯åˆ†å‰² | âœ… è¤‡é›‘ãªåˆ†å‰² | ğŸ”® å°†æ¥å¯¾å¿œ | ğŸ”® å°†æ¥å¯¾å¿œ |
| è¨­å®šç®¡ç† | âœ… æ°¸ç¶šåŒ–ãƒ•ã‚¡ã‚¤ãƒ« | ğŸ”® ã‚»ãƒƒã‚·ãƒ§ãƒ³+iCloud | ğŸ”® ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã¿ |
| Apple Reminders | âœ… AppleScript | ğŸ”® ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆ | ğŸ”® æ‰‹å‹•ã‚³ãƒ”ãƒ¼ |
| Calendarçµ±åˆ | âœ… AppleScript | ğŸ”® ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆ | ğŸ”® æ‰‹å‹•å…¥åŠ› |
| Notionçµ±åˆ | âœ… MCPçµŒç”± | ğŸ”® ConnectorçµŒç”± | ğŸ”® æ‰‹å‹•ã‚³ãƒ”ãƒ¼ |

> **å‡¡ä¾‹**: âœ… å®Ÿè£…æ¸ˆã¿ã€ğŸ”® å°†æ¥å¯¾å¿œäºˆå®šï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

#### 1. Platform Adaptation Layer
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¤œå‡ºã¨ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼é¸æŠ
- MCP/Skillsé–“ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ã®æœ€é©åŒ–

#### 2. MCP Interface Layer (Desktop/Code)
- MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å®Ÿè£…
- ãƒ„ãƒ¼ãƒ«å®šç¾©ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨å¿œç­”ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### 3. Skills Interface Layer (iOS/iPadOS/Web)
- Claude Skills APIã®å®Ÿè£…
- ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆã®æ´»ç”¨
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ã‚¹ãƒ†ãƒ¼ãƒˆä¿æŒ

#### 4. Setup & Config Layer
- åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥è¨­å®šã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- è¨­å®šå€¤ã®æ¤œè¨¼ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

#### 5. Core Analysis Layer
- ã‚¿ã‚¹ã‚¯ã®åˆ†å‰²ã¨æ•´ç†
- å„ªå…ˆåº¦åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
- æ™‚é–“è¦‹ç©ã‚‚ã‚Šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- é–¢ä¿‚è€…æŠ½å‡ºã‚¨ãƒ³ã‚¸ãƒ³

#### 6. Integration Layer
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®çµ±åˆ
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥çµ±åˆæ–¹å¼ã®é¸æŠ
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã¨ãƒãƒƒãƒ”ãƒ³ã‚°

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 0. PlatformAdapter

**è²¬ä»»:** ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¤œå‡ºã¨é©åˆ‡ãªã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®é¸æŠ

```typescript
interface PlatformAdapter {
  detectPlatform(): Promise<PlatformInfo>;
  createSageInstance(): Promise<SageCore>;
  getAvailableFeatures(): FeatureSet;
}

interface PlatformInfo {
  type: 'desktop_mcp' | 'ios_skills' | 'ipados_skills' | 'web_skills';
  version: string;
  capabilities: PlatformCapability[];
  nativeIntegrations: string[];
}

interface PlatformCapability {
  name: string;
  available: boolean;
  requiresPermission: boolean;
  fallbackAvailable: boolean;
}

interface FeatureSet {
  taskAnalysis: boolean;
  persistentConfig: boolean;
  appleReminders: boolean;
  calendarIntegration: boolean;
  notionIntegration: boolean;
  fileSystemAccess: boolean;
}

// ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥å®Ÿè£…
class MCPAdapter implements PlatformAdapter {
  // Desktop/Codeå‘ã‘MCPå®Ÿè£…
}

class SkillsAdapteriOS implements PlatformAdapter {
  // iOS/iPadOSå‘ã‘Skillså®Ÿè£…ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆä»˜ãï¼‰
}

class SkillsAdapterWeb implements PlatformAdapter {
  // Webå‘ã‘Skillså®Ÿè£…ï¼ˆåŸºæœ¬æ©Ÿèƒ½ã®ã¿ï¼‰
}
```

### 1. SetupWizard

**è²¬ä»»:** ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é©å¿œå‹ã®åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰

```typescript
interface SetupWizard {
  checkStatus(): Promise<SetupStatus>;
  startWizard(mode?: 'full' | 'quick', platform?: PlatformInfo): Promise<WizardSession>;
  answerQuestion(sessionId: string, questionId: string, answer: any): Promise<AnswerResult>;
  saveConfig(sessionId: string, confirm: boolean): Promise<SaveResult>;
}

interface WizardSession {
  sessionId: string;
  currentStep: number;
  totalSteps: number;
  question: Question;
  progress: number;
  answers: Record<string, any>;
  platformOptimized: boolean; // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æœ€é©åŒ–ãƒ•ãƒ©ã‚°
}

interface Question {
  id: string;
  text: string;
  type: 'text' | 'select' | 'multiselect' | 'time' | 'days';
  options?: string[];
  defaultValue?: any;
  helpText?: string;
  validation?: ValidationRule[];
  platformSpecific?: string[]; // ç‰¹å®šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã®ã¿è¡¨ç¤º
}

// ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
interface SetupQuestionSet {
  common: Question[]; // å…¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å…±é€š
  desktop: Question[]; // Desktop/Codeå°‚ç”¨
  ios: Question[]; // iOS/iPadOSå°‚ç”¨
  web: Question[]; // Webå°‚ç”¨
}
```

### 2. TaskSplitter

**è²¬ä»»:** è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚„è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®åˆ†å‰²

```typescript
interface TaskSplitter {
  splitTasks(input: string): Promise<SplitResult>;
  analyzeComplexity(task: Task): Promise<ComplexityAnalysis>;
}

interface SplitResult {
  originalInput: string;
  splitTasks: Task[];
  splitReason: string;
  recommendedOrder: number[];
  dependencies: TaskDependency[];
}

interface ComplexityAnalysis {
  isComplex: boolean;
  complexity: 'simple' | 'medium' | 'complex' | 'project';
  suggestedSplits?: SubTask[];
  reasoning: string;
}

interface TaskDependency {
  taskIndex: number;
  dependsOn: number[];
  type: 'sequential' | 'parallel' | 'conditional';
}
```

### 3. TaskAnalyzer

**è²¬ä»»:** ã‚¿ã‚¹ã‚¯ã®åŒ…æ‹¬çš„åˆ†æ

```typescript
interface TaskAnalyzer {
  analyzeTasks(tasks: Task[], config: UserConfig): Promise<AnalyzedTask[]>;
}

interface AnalyzedTask {
  original: Task;
  priority: Priority;
  estimatedMinutes: number;
  stakeholders: string[];
  suggestedReminders: Reminder[];
  suggestedTimeSlot?: TimeSlot;
  reasoning: AnalysisReasoning;
  tags: string[];
}

interface AnalysisReasoning {
  priorityReason: string;
  estimationReason: string;
  stakeholderReason: string;
  schedulingReason?: string;
}
```

### 4. PriorityEngine

**è²¬ä»»:** å„ªå…ˆåº¦åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```typescript
interface PriorityEngine {
  determinePriority(task: Task, rules: PriorityRules): Priority;
  evaluateConditions(task: Task, conditions: PriorityCondition[]): boolean;
}

interface PriorityCondition {
  type: 'deadline' | 'keyword' | 'stakeholder' | 'blocking' | 'custom';
  operator: '<' | '>' | '=' | 'contains' | 'matches';
  value: any;
  unit?: 'hours' | 'days' | 'weeks';
  description: string;
  weight?: number;
}

type Priority = 'P0' | 'P1' | 'P2' | 'P3';
```

### 5. TimeEstimator

**è²¬ä»»:** æ‰€è¦æ™‚é–“è¦‹ç©ã‚‚ã‚Š

```typescript
interface TimeEstimator {
  estimateDuration(task: Task, config: EstimationConfig): number;
  analyzeKeywords(text: string): ComplexityKeywords;
}

interface EstimationConfig {
  simpleTaskMinutes: number;
  mediumTaskMinutes: number;
  complexTaskMinutes: number;
  projectTaskMinutes: number;
  keywordMapping: Record<string, string[]>;
  userAdjustments?: Record<string, number>;
}

interface ComplexityKeywords {
  simple: string[];
  medium: string[];
  complex: string[];
  project: string[];
  matched: string[];
}
```

### 6. StakeholderExtractor

**è²¬ä»»:** é–¢ä¿‚è€…ã®è­˜åˆ¥ã¨æŠ½å‡º

```typescript
interface StakeholderExtractor {
  extractStakeholders(task: Task, teamConfig: TeamConfig): string[];
  findMentions(text: string): string[];
  matchTeamMembers(text: string, team: TeamMember[]): TeamMember[];
}

interface TeamMember {
  name: string;
  role: 'manager' | 'lead' | 'team' | 'collaborator';
  keywords: string[];
  priority?: number;
}
```

### 7. AppleRemindersService

**è²¬ä»»:** ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é©å¿œå‹Apple Remindersçµ±åˆ

```typescript
interface AppleRemindersService {
  createReminder(request: ReminderRequest): Promise<ReminderResult>;
  detectPlatform(): Promise<PlatformInfo>;
  isAvailable(): Promise<boolean>;
}

interface PlatformInfo {
  platform: 'ios' | 'ipados' | 'macos' | 'web' | 'unknown';
  hasNativeIntegration: boolean;
  supportsAppleScript: boolean;
  recommendedMethod: 'native' | 'applescript' | 'fallback';
}

interface ReminderRequest {
  title: string;
  notes?: string;
  dueDate?: string;
  list?: string;
  priority?: 'low' | 'medium' | 'high';
  alarms?: AlarmConfig[];
}

interface AlarmConfig {
  type: 'absolute' | 'relative';
  datetime?: string;
  offsetMinutes?: number;
}

interface ReminderResult {
  success: boolean;
  method: 'native' | 'applescript' | 'fallback';
  reminderId?: string;
  error?: string;
  platformInfo?: PlatformInfo;
}
```

### 8. NativeIntegrationService (å°†æ¥å¯¾å¿œäºˆå®š - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼)

> **æ³¨æ„**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å°†æ¥ã®iOS/iPadOS Skillså¯¾å¿œã®ãŸã‚ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã§ã™ã€‚
> ç¾åœ¨ã€Claude Skills APIã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§å®Ÿè¡Œã•ã‚Œã€iOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆEventKitç­‰ï¼‰ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚
> ä»¥ä¸‹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã€AnthropicãŒSkillsã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ãŸæ™‚ç‚¹ã§å®Ÿè£…äºˆå®šã§ã™ã€‚

**è²¬ä»»:** Claude Skillsç’°å¢ƒã§ã®ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆï¼ˆå°†æ¥å®Ÿè£…äºˆå®šï¼‰

```typescript
// ğŸ”® å°†æ¥å¯¾å¿œäºˆå®šã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
interface NativeIntegrationService {
  createReminder(request: ReminderRequest): Promise<ReminderResult>;
  fetchCalendarEvents(startDate: string, endDate: string): Promise<CalendarEvent[]>;
  findAvailableSlots(request: SlotRequest): Promise<AvailableSlot[]>;
  createNotionPage(request: NotionPageRequest): Promise<NotionPageResult>;
  checkPermissions(): Promise<PermissionStatus>;
}

interface PermissionStatus {
  reminders: 'granted' | 'denied' | 'not_determined';
  calendar: 'granted' | 'denied' | 'not_determined';
  notion: 'granted' | 'denied' | 'not_determined';
  canRequestPermission: boolean;
}

// ğŸ”® å°†æ¥å®Ÿè£…äºˆå®š: iOS/iPadOS Skillså®Ÿè£…
// ç¾æ™‚ç‚¹ã§ã¯ window.claude?.remindersã€window.claude?.calendarã€
// window.claude?.notion ã®APIã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
// ã“ã‚Œã‚‰ã¯ä»®æƒ³çš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã‚ã‚Šã€
// AnthropicãŒSkillsã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ãŸæ™‚ç‚¹ã§
// å®Ÿéš›ã®APIã«åˆã‚ã›ã¦å®Ÿè£…ã—ã¾ã™ã€‚
```

### 9. CalendarService

**è²¬ä»»:** ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é©å¿œå‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼çµ±åˆã¨ç©ºãæ™‚é–“æ¤œå‡º

```typescript
interface CalendarService {
  findAvailableSlots(request: SlotRequest, config: CalendarConfig): Promise<AvailableSlot[]>;
  fetchEvents(startDate: string, endDate: string): Promise<CalendarEvent[]>;
  calculateSuitability(slot: TimeSlot, config: CalendarConfig): SlotSuitability;
  detectCalendarPlatform(): Promise<CalendarPlatformInfo>;
  isCalendarAccessible(): Promise<boolean>;
}

interface CalendarPlatformInfo {
  platform: 'ios' | 'ipados' | 'macos' | 'web' | 'unknown';
  availableMethods: CalendarMethod[];
  recommendedMethod: CalendarMethod;
  requiresPermission: boolean;
  hasNativeAccess: boolean;
}

type CalendarMethod = 'native' | 'applescript' | 'caldav' | 'ical_url' | 'manual_input' | 'outlook';

interface SlotRequest {
  taskDuration: number;
  preferredDays?: string[];
  avoidDays?: string[];
  startDate?: string;
  endDate?: string;
  timeOfDay?: 'morning' | 'afternoon' | 'evening';
}

interface AvailableSlot {
  start: string;
  end: string;
  durationMinutes: number;
  suitability: 'excellent' | 'good' | 'acceptable';
  reason: string;
  conflicts: string[];
  dayType: 'deep-work' | 'meeting-heavy' | 'normal';
  source: CalendarMethod;
}

interface CalendarEvent {
  id: string;
  title: string;
  start: string;
  end: string;
  isAllDay: boolean;
  source: CalendarMethod;
}
```

**è²¬ä»»:** ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šã¨ç®¡ç†

```typescript
interface ReminderManager {
  setReminder(request: ReminderRequest, config: UserConfig): Promise<ReminderResult>;
  determineDestination(task: Task, config: UserConfig): 'apple' | 'notion';
  calculateReminderTimes(deadline: string, types: string[]): ReminderTime[];
}

interface ReminderRequest {
  taskTitle: string;
  reminderType: string;
  targetDate?: string;
  list?: string;
  priority?: Priority;
}

interface ReminderResult {
  success: boolean;
  destination: 'apple_reminders' | 'notion_mcp';
  reminderId?: string;
  reminderUrl?: string;
  error?: string;
}

### 10. ReminderManager

**è²¬ä»»:** ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šã¨ç®¡ç†

```typescript
interface ReminderManager {
  setReminder(request: ReminderRequest, config: UserConfig): Promise<ReminderResult>;
  determineDestination(task: Task, config: UserConfig): 'apple' | 'notion';
  calculateReminderTimes(deadline: string, types: string[]): ReminderTime[];
}

interface ReminderRequest {
  taskTitle: string;
  reminderType: string;
  targetDate?: string;
  list?: string;
  priority?: Priority;
}

interface ReminderResult {
  success: boolean;
  destination: 'apple_reminders' | 'notion_mcp';
  method?: 'native' | 'applescript' | 'fallback';
  reminderId?: string;
  reminderUrl?: string;
  error?: string;
}
```

### 15. RemoteMCPServer

**è²¬ä»»:** Remote MCP Serverå®Ÿè£…ã¨HTTP/WebSocketé€šä¿¡

```typescript
interface RemoteMCPServer {
  startServer(port: number, config: RemoteMCPConfig): Promise<void>;
  handleMCPRequest(request: MCPRequest): Promise<MCPResponse>;
  authenticateUser(token: string): Promise<AuthResult>;
  validateRequest(request: MCPRequest): Promise<ValidationResult>;
}

interface RemoteMCPConfig {
  port: number;
  host: string;
  httpsEnabled: boolean;
  corsOrigins: string[];
  oauth: OAuthConfig;
  rateLimit: RateLimitConfig;
  logging: LoggingConfig;
}

interface OAuthConfig {
  clientId: string;
  clientSecret: string;
  redirectUri: string;
  scopes: string[];
  provider: 'claude' | 'custom';
}

interface RateLimitConfig {
  requestsPerMinute: number;
  requestsPerHour: number;
  burstLimit: number;
  whitelistedIPs: string[];
}

interface MCPRequest {
  method: string;
  params: any;
  id: string | number;
  jsonrpc: '2.0';
  headers: Record<string, string>;
  userId?: string;
}

interface MCPResponse {
  result?: any;
  error?: MCPError;
  id: string | number;
  jsonrpc: '2.0';
}

interface MCPError {
  code: number;
  message: string;
  data?: any;
}

interface AuthResult {
  success: boolean;
  userId?: string;
  permissions: string[];
  error?: string;
}
```

### 16. CloudConfigManager

**è²¬ä»»:** ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®è¨­å®šç®¡ç†ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿åŒæœŸ

```typescript
interface CloudConfigManager {
  saveUserConfig(userId: string, config: UserConfig): Promise<SaveResult>;
  loadUserConfig(userId: string): Promise<UserConfig>;
  syncUserData(userId: string): Promise<SyncResult>;
  migrateFromLocal(localConfig: UserConfig, userId: string): Promise<MigrationResult>;
}

interface SaveResult {
  success: boolean;
  version: string;
  lastModified: string;
  error?: string;
}

interface SyncResult {
  success: boolean;
  conflictsResolved: number;
  lastSyncTime: string;
  error?: string;
}

interface MigrationResult {
  success: boolean;
  migratedSettings: string[];
  warnings: string[];
  error?: string;
}

// ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…ä¾‹
class CloudConfigManagerImpl implements CloudConfigManager {
  private storage: CloudStorage; // AWS S3, Google Cloud Storage, etc.
  private encryption: EncryptionService;
  
  async saveUserConfig(userId: string, config: UserConfig): Promise<SaveResult> {
    try {
      const encryptedConfig = await this.encryption.encrypt(JSON.stringify(config));
      const key = `users/${userId}/config.json`;
      
      await this.storage.put(key, encryptedConfig, {
        metadata: {
          version: config.version,
          lastModified: new Date().toISOString(),
          userId
        }
      });
      
      return {
        success: true,
        version: config.version,
        lastModified: new Date().toISOString()
      };
    } catch (error) {
      return {
        success: false,
        version: config.version,
        lastModified: new Date().toISOString(),
        error: error.message
      };
    }
  }
}
```

### 17. WebAPIIntegrationService

**è²¬ä»»:** Web APIçµŒç”±ã§ã®å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆï¼ˆRemote MCPå°‚ç”¨ï¼‰

```typescript
interface WebAPIIntegrationService {
  // Apple Services (iCloud Web API)
  createAppleReminder(userId: string, request: ReminderRequest): Promise<ReminderResult>;
  getAppleCalendarEvents(userId: string, dateRange: DateRange): Promise<CalendarEvent[]>;
  
  // Notion Direct API
  createNotionPage(userId: string, request: NotionPageRequest): Promise<NotionPageResult>;
  getNotionTasks(userId: string, filter?: NotionFilter): Promise<NotionTask[]>;
  
  // Google Calendar API
  getGoogleCalendarEvents(userId: string, dateRange: DateRange): Promise<CalendarEvent[]>;
  
  // Microsoft Outlook API
  getOutlookCalendarEvents(userId: string, dateRange: DateRange): Promise<CalendarEvent[]>;
}

interface AppleWebAPIConfig {
  iCloudBaseUrl: string;
  clientId: string;
  clientSecret: string;
  redirectUri: string;
}

interface NotionDirectAPIConfig {
  apiKey: string;
  version: string;
  baseUrl: string;
}

// Apple iCloud Web APIçµ±åˆä¾‹
class AppleWebAPIService {
  private config: AppleWebAPIConfig;
  private tokenManager: TokenManager;
  
  async createReminder(userId: string, request: ReminderRequest): Promise<ReminderResult> {
    try {
      const token = await this.tokenManager.getAppleToken(userId);
      
      const response = await fetch(`${this.config.iCloudBaseUrl}/reminders/api/v1/reminders`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title: request.title,
          notes: request.notes,
          dueDate: request.dueDate,
          list: request.list,
          priority: this.mapPriority(request.priority)
        })
      });
      
      if (!response.ok) {
        throw new Error(`Apple API error: ${response.status}`);
      }
      
      const result = await response.json();
      
      return {
        success: true,
        method: 'web_api',
        reminderId: result.id,
        reminderUrl: result.url
      };
    } catch (error) {
      return {
        success: false,
        method: 'web_api',
        error: `Apple Web APIçµ±åˆã‚¨ãƒ©ãƒ¼: ${error.message}`
      };
    }
  }
}
```

### 18. TodoListManager

```typescript
interface TodoListManager {
  listTodos(filter?: TodoFilter): Promise<TodoItem[]>;
  updateTaskStatus(taskId: string, status: TaskStatus, source: TaskSource): Promise<UpdateResult>;
  getTodaysTasks(): Promise<TodoItem[]>;
  syncTaskAcrossSources(taskId: string): Promise<SyncResult>;
}

interface TodoFilter {
  priority?: Priority[];
  status?: TaskStatus[];
  dueDate?: DateRange;
  source?: TaskSource[];
  tags?: string[];
}

interface TodoItem {
  id: string;
  title: string;
  description?: string;
  priority: Priority;
  status: TaskStatus;
  dueDate?: string;
  createdDate: string;
  updatedDate: string;
  source: TaskSource;
  sourceId: string; // Apple Reminders ID or Notion Page ID
  tags: string[];
  estimatedMinutes?: number;
  stakeholders?: string[];
}

type TaskSource = 'apple_reminders' | 'notion' | 'manual';
type TaskStatus = 'not_started' | 'in_progress' | 'completed' | 'cancelled';

interface UpdateResult {
  success: boolean;
  taskId: string;
  updatedFields: string[];
  syncedSources: TaskSource[];
  error?: string;
}

interface SyncResult {
  success: boolean;
  taskId: string;
  syncedSources: TaskSource[];
  conflicts?: TaskConflict[];
  error?: string;
}

interface TaskConflict {
  field: string;
  appleRemindersValue: any;
  notionValue: any;
  resolvedValue: any;
  resolution: 'apple_reminders' | 'notion' | 'manual';
}

interface DateRange {
  start?: string;
  end?: string;
}
```

### 19. TaskSynchronizer

**è²¬ä»»:** è¤‡æ•°ã‚½ãƒ¼ã‚¹é–“ã§ã®ã‚¿ã‚¹ã‚¯åŒæœŸã¨ç«¶åˆè§£æ±º

```typescript
interface TaskSynchronizer {
  syncAllTasks(): Promise<SyncAllResult>;
  resolveConflicts(conflicts: TaskConflict[]): Promise<ConflictResolution>;
  detectDuplicates(): Promise<DuplicateTask[]>;
  mergeDuplicates(duplicates: DuplicateTask[]): Promise<MergeResult>;
}

interface SyncAllResult {
  totalTasks: number;
  syncedTasks: number;
  conflicts: TaskConflict[];
  errors: SyncError[];
  duration: number;
}

interface DuplicateTask {
  tasks: TodoItem[];
  similarity: number;
  suggestedMerge: TodoItem;
  confidence: 'high' | 'medium' | 'low';
}

interface MergeResult {
  success: boolean;
  mergedTask: TodoItem;
  removedTasks: string[];
  error?: string;
}

interface SyncError {
  taskId: string;
  source: TaskSource;
  error: string;
  recoverable: boolean;
}
```

### 20. NotionMCPService

```typescript
interface NotionMCPService {
  createPage(request: NotionPageRequest): Promise<NotionPageResult>;
  searchPages(query: string): Promise<NotionPage[]>;
  updatePage(pageId: string, updates: NotionPageUpdates): Promise<NotionPageResult>;
  isAvailable(): Promise<boolean>;
}

interface NotionPageRequest {
  databaseId: string;
  title: string;
  properties: Record<string, any>;
  content?: NotionBlock[];
}

interface NotionPageResult {
  success: boolean;
  pageId?: string;
  pageUrl?: string;
  error?: string;
}

interface NotionBlock {
  type: 'paragraph' | 'heading' | 'bulleted_list_item';
  content: string;
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Core Models

```typescript
interface Task {
  title: string;
  description?: string;
  deadline?: string;
  dependencies?: string[];
  status?: TaskStatus;
  tags?: string[];
  metadata?: Record<string, any>;
}

type TaskStatus = 'not_started' | 'in_progress' | 'blocked' | 'completed';

interface UserConfig {
  version: string;
  createdAt: string;
  lastUpdated: string;
  user: UserProfile;
  calendar: CalendarConfig;
  priorityRules: PriorityRules;
  estimation: EstimationConfig;
  reminders: RemindersConfig;
  team: TeamConfig;
  integrations: IntegrationsConfig;
  preferences: PreferencesConfig;
}

interface UserProfile {
  name: string;
  email?: string;
  timezone: string;
  role?: string;
}

interface CalendarConfig {
  workingHours: {
    start: string;
    end: string;
  };
  meetingHeavyDays: string[];
  deepWorkDays: string[];
  deepWorkBlocks: DeepWorkBlock[];
  timeZone: string;
}

interface DeepWorkBlock {
  day: string;
  startHour: number;
  endHour: number;
  description: string;
}
```

### Configuration Models

```typescript
interface PriorityRules {
  p0Conditions: PriorityCondition[];
  p1Conditions: PriorityCondition[];
  p2Conditions: PriorityCondition[];
  defaultPriority: Priority;
}

interface RemindersConfig {
  defaultTypes: string[];
  weeklyReview: {
    enabled: boolean;
    day: string;
    time: string;
    description: string;
  };
  customRules: ReminderRule[];
}

interface ReminderRule {
  condition: string;
  reminders: string[];
  description?: string;
}

interface TeamConfig {
  manager?: TeamMember;
  frequentCollaborators: TeamMember[];
  departments: string[];
}

interface IntegrationsConfig {
  appleReminders: AppleRemindersConfig;
  notion: NotionConfig;
  googleCalendar: GoogleCalendarConfig;
  platform: PlatformSpecificConfig; // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰è¨­å®š
}

interface PlatformSpecificConfig {
  type: 'desktop_mcp' | 'ios_skills' | 'ipados_skills' | 'web_skills';
  nativeIntegrationsEnabled: boolean;
  fallbackMethods: string[];
  permissionsGranted: Record<string, boolean>;
}

interface AppleRemindersConfig {
  enabled: boolean;
  threshold: number;
  unit: 'days' | 'hours';
  defaultList: string;
  lists: Record<string, string>;
  platformAdaptive: boolean; // ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é©å¿œå‹çµ±åˆ
  preferNativeIntegration: boolean; // iOS/iPadOSã§ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆã‚’å„ªå…ˆ
  appleScriptFallback: boolean; // macOSã§AppleScriptä½¿ç”¨
  skillsIntegration?: SkillsIntegrationConfig; // Skillsç‰ˆå°‚ç”¨è¨­å®š
}

interface SkillsIntegrationConfig {
  useNativeAPI: boolean;
  requestPermissionOnStartup: boolean;
  fallbackToManualCopy: boolean;
  sessionPersistence: boolean;
}

interface NotionConfig {
  enabled: boolean;
  threshold: number;
  unit: 'days' | 'hours';
  databaseId: string;
  databaseUrl?: string;
  mcpServerName: string; // MCPçµŒç”±ã§ã®Notionæ¥ç¶šç”¨ï¼ˆDesktop/Codeå°‚ç”¨ï¼‰
  propertyMappings?: Record<string, string>;
  skillsFallback?: boolean; // Skillsç‰ˆã§ã®æ‰‹å‹•ã‚³ãƒ”ãƒ¼æ¨å¥¨ãƒ•ãƒ©ã‚°
}

interface GoogleCalendarConfig {
  enabled: boolean;
  method: CalendarMethod;
  platformAdaptive: boolean;
  // ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆç”¨ï¼ˆiOS/iPadOS Skillsï¼‰
  preferNativeAccess: boolean;
  nativeCalendarPermission?: boolean;
  // AppleScriptç”¨ï¼ˆmacOS MCPï¼‰
  appleScriptFallback: boolean;
  // ä»£æ›¿æ‰‹æ®µç”¨
  icalUrl?: string;
  outlookIntegration?: boolean;
  manualInputFallback: boolean;
  // å¾“æ¥ã®APIè¨­å®šï¼ˆä½¿ç”¨ã•ã‚Œãªã„å¯èƒ½æ€§ãŒé«˜ã„ï¼‰
  defaultCalendar?: string;
  conflictDetection: boolean;
  lookAheadDays: number;
  // Skillsç‰ˆå°‚ç”¨è¨­å®š
  skillsCalendarIntegration?: SkillsCalendarConfig;
}

interface SkillsCalendarConfig {
  useNativeCalendarAPI: boolean;
  cacheEvents: boolean;
  cacheDurationMinutes: number;
  requestPermissionFlow: boolean;
}
```

## ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥å®Ÿè£…æˆ¦ç•¥

### 1. Desktop/Code (MCP Server)

**ç‰¹å¾´:**
- å®Œå…¨æ©Ÿèƒ½ã®å®Ÿè£…
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚¯ã‚»ã‚¹
- å¤–éƒ¨ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œï¼ˆAppleScriptï¼‰
- MCPçµŒç”±ã§ã®Notionçµ±åˆ

**å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:**
```typescript
// MCP Server Entry Point
class SageMCPServer {
  private setupWizard: SetupWizard;
  private taskAnalyzer: TaskAnalyzer;
  private configManager: ConfigManager;
  private integrations: {
    appleReminders: AppleRemindersService;
    calendar: CalendarService;
    notion: NotionMCPService;
  };
  
  async initialize(): Promise<void> {
    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹è¨­å®šã®èª­ã¿è¾¼ã¿
    await this.configManager.loadFromFile('~/.sage/config.json');
    
    // çµ±åˆã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–
    await this.initializeIntegrations();
  }
  
  // MCPãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…
  async handleAnalyzeTasks(params: any): Promise<any> {
    const tasks = await this.taskAnalyzer.analyzeTasks(params.tasks, this.config);
    return this.formatMCPResponse(tasks);
  }
}
```

### 2. iOS/iPadOS (Claude Skills) - ğŸ”® å°†æ¥å¯¾å¿œäºˆå®š

> **ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å°†æ¥å¯¾å¿œäºˆå®šã®è¨­è¨ˆã§ã™ã€‚
> ç¾åœ¨ã€Claude Skills APIã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§å®Ÿè¡Œã•ã‚Œã€
> iOSã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆEventKitç­‰ï¼‰ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚

**å°†æ¥ã®ç‰¹å¾´ï¼ˆäºˆå®šï¼‰:**
- ãƒã‚¤ãƒ†ã‚£ãƒ–çµ±åˆã®æ´»ç”¨ï¼ˆEventKitã€Remindersï¼‰
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹è¨­å®š + iCloudåŒæœŸ
- æ¨©é™ç®¡ç†ã®è€ƒæ…®
- Notion Connectorçµ±åˆ

**å°†æ¥ã®å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰:**
```typescript
// ğŸ”® å°†æ¥å®Ÿè£…äºˆå®š: Skills Entry Point
// ç¾æ™‚ç‚¹ã§ã¯ window.claude?.remindersã€window.claude?.calendar ã¯å­˜åœ¨ã—ã¾ã›ã‚“
// AnthropicãŒSkillsã‹ã‚‰ãƒ‡ãƒã‚¤ã‚¹APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ãŸæ™‚ç‚¹ã§å®Ÿè£…äºˆå®š

class SageSkillsiOS {
  // å°†æ¥å®Ÿè£…äºˆå®š
  // å®Ÿéš›ã®APIãŒå…¬é–‹ã•ã‚ŒãŸæ™‚ç‚¹ã§ã€ãã®APIã«åˆã‚ã›ã¦å®Ÿè£…ã—ã¾ã™
}
```

### 3. Web (Claude Skills - Limited) - ğŸ”® å°†æ¥å¯¾å¿œäºˆå®š

> **ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼**: ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å°†æ¥å¯¾å¿œäºˆå®šã®è¨­è¨ˆã§ã™ã€‚
> Web Skillsç‰ˆã¯ã€Claude Skills APIãŒä¸€èˆ¬å…¬é–‹ã•ã‚ŒãŸæ™‚ç‚¹ã§å®Ÿè£…äºˆå®šã§ã™ã€‚

**å°†æ¥ã®ç‰¹å¾´ï¼ˆäºˆå®šï¼‰:**
- åŸºæœ¬æ©Ÿèƒ½ã®ã¿ï¼ˆã‚¿ã‚¹ã‚¯åˆ†æï¼‰
- ã‚»ãƒƒã‚·ãƒ§ãƒ³é™å®šè¨­å®š
- æ‰‹å‹•ã‚³ãƒ”ãƒ¼ç”¨ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
- è»½é‡å®Ÿè£…

**å°†æ¥ã®å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰:**
```typescript
// ğŸ”® å°†æ¥å®Ÿè£…äºˆå®š: Web Skills Entry Point
class SageSkillsWeb {
  // å°†æ¥å®Ÿè£…äºˆå®š
  // Claude Skills APIãŒå…¬é–‹ã•ã‚ŒãŸæ™‚ç‚¹ã§å®Ÿè£…ã—ã¾ã™
}
```

### 4. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¤œå‡ºã¨ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼é¸æŠ

```typescript
class PlatformDetector {
  static async detect(): Promise<PlatformInfo> {
    // MCPç’°å¢ƒã®æ¤œå‡º
    if (typeof process !== 'undefined' && process.env.MCP_SERVER) {
      return {
        type: 'desktop_mcp',
        capabilities: ['file_system', 'external_process', 'mcp_integration'],
        nativeIntegrations: ['applescript', 'notion_mcp']
      };
    }
    
    // Claude Skillsç’°å¢ƒã®æ¤œå‡º
    if (typeof window !== 'undefined' && window.claude) {
      const userAgent = navigator.userAgent;
      
      if (userAgent.includes('iPhone') || userAgent.includes('iPad')) {
        return {
          type: userAgent.includes('iPad') ? 'ipados_skills' : 'ios_skills',
          capabilities: ['native_reminders', 'native_calendar', 'session_storage'],
          nativeIntegrations: ['reminders', 'calendar']
        };
      }
      
      return {
        type: 'web_skills',
        capabilities: ['session_storage'],
        nativeIntegrations: []
      };
    }
    
    throw new Error('Unsupported platform');
  }
}

// ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®å®Ÿè£…é¸æŠ
class SageFactory {
  static async create(): Promise<SageCore> {
    const platform = await PlatformDetector.detect();
    
    switch (platform.type) {
      case 'desktop_mcp':
        return new SageMCPServer();
      case 'ios_skills':
      case 'ipados_skills':
        return new SageSkillsiOS();
      case 'web_skills':
        return new SageSkillsWeb();
      default:
        throw new Error(`Unsupported platform: ${platform.type}`);
    }
  }
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼åˆ†é¡

```typescript
enum ErrorType {
  SETUP_ERROR = 'SETUP_ERROR',
  CONFIG_ERROR = 'CONFIG_ERROR',
  VALIDATION_ERROR = 'VALIDATION_ERROR',
  INTEGRATION_ERROR = 'INTEGRATION_ERROR',
  ANALYSIS_ERROR = 'ANALYSIS_ERROR',
  NETWORK_ERROR = 'NETWORK_ERROR',
  AUTH_ERROR = 'AUTH_ERROR'
}

interface SageError {
  type: ErrorType;
  code: string;
  message: string;
  details?: any;
  recoverable: boolean;
  suggestions?: string[];
}
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

1. **Graceful Degradation**: ä¸€éƒ¨ã®æ©Ÿèƒ½ãŒå¤±æ•—ã—ã¦ã‚‚ã€ä»–ã®æ©Ÿèƒ½ã¯ç¶™ç¶šå‹•ä½œ
2. **Retry Logic**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚„ä¸€æ™‚çš„ãªéšœå®³ã«å¯¾ã™ã‚‹è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤
3. **User-Friendly Messages**: æŠ€è¡“çš„ãªã‚¨ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜
4. **Recovery Suggestions**: ã‚¨ãƒ©ãƒ¼è§£æ±ºã®ãŸã‚ã®å…·ä½“çš„ãªææ¡ˆ

```typescript
class ErrorHandler {
  static handle(error: Error, context: string): SageError {
    // ã‚¨ãƒ©ãƒ¼åˆ†é¡ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  }
  
  static shouldRetry(error: SageError): boolean {
    // ãƒªãƒˆãƒ©ã‚¤å¯èƒ½ã‹ã©ã†ã‹ã®åˆ¤å®š
  }
  
  static getSuggestions(error: SageError): string[] {
    // ã‚¨ãƒ©ãƒ¼è§£æ±ºã®ãŸã‚ã®ææ¡ˆç”Ÿæˆ
  }
}
```

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   E2E Tests     â”‚  â† çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå°‘æ•°ï¼‰
    â”‚   (5-10%)       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Integration     â”‚  â† APIçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆä¸­ç¨‹åº¦ï¼‰
    â”‚ Tests (20-30%)  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Unit Tests     â”‚  â† å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå¤šæ•°ï¼‰
    â”‚  (60-70%)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ†ã‚¹ãƒˆåˆ†é¡

#### 1. Unit Tests
- å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å˜ä½“ãƒ†ã‚¹ãƒˆ
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('PriorityEngine', () => {
  describe('determinePriority', () => {
    it('should return P0 for tasks with 24h deadline', () => {
      // ãƒ†ã‚¹ãƒˆå®Ÿè£…
    });
    
    it('should return P0 for tasks with urgent keywords', () => {
      // ãƒ†ã‚¹ãƒˆå®Ÿè£…
    });
    
    it('should return P1 for manager requests', () => {
      // ãƒ†ã‚¹ãƒˆå®Ÿè£…
    });
  });
});
```

#### 2. Integration Tests
- å¤–éƒ¨APIçµ±åˆã®ãƒ†ã‚¹ãƒˆ
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ããƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

```typescript
describe('NotionService Integration', () => {
  it('should create page in Notion database', async () => {
    // Notion APIçµ±åˆãƒ†ã‚¹ãƒˆ
  });
  
  it('should handle API rate limits gracefully', async () => {
    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ãƒ†ã‚¹ãƒˆ
  });
});
```

#### 3. E2E Tests
- å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªã®æ¤œè¨¼

```typescript
describe('Complete Task Analysis Flow', () => {
  it('should analyze tasks from setup to reminder creation', async () => {
    // 1. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    // 2. ã‚¿ã‚¹ã‚¯åˆ†æ
    // 3. ãƒªãƒã‚¤ãƒ³ãƒ‰ä½œæˆ
    // 4. çµæœæ¤œè¨¼
  });
});
```

### ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–

```typescript
// å¤–éƒ¨APIå‘¼ã³å‡ºã—ã®ãƒ¢ãƒƒã‚¯
jest.mock('./integrations/notion', () => ({
  NotionService: {
    createPage: jest.fn().mockResolvedValue({ id: 'mock-page-id' })
  }
}));

// è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ã‚¿ãƒ–
const mockConfig: UserConfig = {
  // ãƒ†ã‚¹ãƒˆç”¨è¨­å®š
};
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯`~/.sage/`ã«ä¿å­˜
- **æš—å·åŒ–**: æ©Ÿå¯†æƒ…å ±ï¼ˆAPIã‚­ãƒ¼ï¼‰ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®é©åˆ‡ãªãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¨­å®š

### 2. API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **èªè¨¼**: å„çµ±åˆã‚µãƒ¼ãƒ“ã‚¹ã®é©åˆ‡ãªèªè¨¼æ–¹å¼ã‚’ä½¿ç”¨
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: APIå‘¼ã³å‡ºã—é »åº¦ã®åˆ¶é™ã¨ç›£è¦–
- **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°**: æ©Ÿå¯†æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã—ãªã„

### 3. å…¥åŠ›æ¤œè¨¼
- **ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®é©åˆ‡ãªæ¤œè¨¼ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- **ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®é˜²æ­¢

```typescript
class SecurityValidator {
  static sanitizeInput(input: string): string {
    // å…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
  }
  
  static validateApiKey(key: string): boolean {
    // APIã‚­ãƒ¼ã®å½¢å¼æ¤œè¨¼
  }
  
  static checkPermissions(filePath: string): boolean {
    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®ç¢ºèª
  }
}
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›®æ¨™
- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: å„è³ªå•ã¸ã®å¿œç­” < 1ç§’
- **ã‚¿ã‚¹ã‚¯åˆ†æ**: 10ã‚¿ã‚¹ã‚¯ã®åˆ†æ < 3ç§’
- **ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ¤œç´¢**: 1é€±é–“ã®ç©ºãæ™‚é–“æ¤œç´¢ < 2ç§’
- **ãƒªãƒã‚¤ãƒ³ãƒ‰ä½œæˆ**: å¤–éƒ¨APIå‘¼ã³å‡ºã— < 5ç§’

### 2. æœ€é©åŒ–æˆ¦ç•¥

#### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
```typescript
class CacheManager {
  private cache = new Map<string, CacheEntry>();
  
  get<T>(key: string): T | null {
    const entry = this.cache.get(key);
    if (entry && entry.expiry > Date.now()) {
      return entry.value;
    }
    return null;
  }
  
  set<T>(key: string, value: T, ttlMs: number): void {
    this.cache.set(key, {
      value,
      expiry: Date.now() + ttlMs
    });
  }
}
```

#### ä¸¦åˆ—å‡¦ç†
```typescript
async function analyzeTasksParallel(tasks: Task[]): Promise<AnalyzedTask[]> {
  const promises = tasks.map(task => 
    Promise.all([
      priorityEngine.determinePriority(task),
      timeEstimator.estimateDuration(task),
      stakeholderExtractor.extractStakeholders(task)
    ])
  );
  
  const results = await Promise.all(promises);
  return results.map(([priority, duration, stakeholders], index) => ({
    original: tasks[index],
    priority,
    estimatedMinutes: duration,
    stakeholders,
    // ...
  }));
}
```

#### ãƒãƒƒãƒå‡¦ç†
```typescript
class BatchProcessor {
  private queue: Task[] = [];
  private batchSize = 10;
  private batchTimeout = 1000; // 1ç§’
  
  async addTask(task: Task): Promise<AnalyzedTask> {
    return new Promise((resolve) => {
      this.queue.push({ task, resolve });
      this.scheduleBatch();
    });
  }
  
  private scheduleBatch(): void {
    if (this.queue.length >= this.batchSize) {
      this.processBatch();
    } else {
      setTimeout(() => this.processBatch(), this.batchTimeout);
    }
  }
}
```

## å›½éš›åŒ–ã¨ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

### å¤šè¨€èªå¯¾å¿œ

```typescript
interface LocaleConfig {
  language: 'ja' | 'en';
  dateFormat: string;
  timeFormat: '12h' | '24h';
  timezone: string;
}

class I18nManager {
  private messages: Record<string, Record<string, string>>;
  
  t(key: string, params?: Record<string, any>): string {
    // ç¿»è¨³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å–å¾—ã¨å¤‰æ•°ç½®æ›
  }
  
  formatDate(date: Date, format?: string): string {
    // ãƒ­ã‚±ãƒ¼ãƒ«ã«å¿œã˜ãŸæ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  }
  
  formatTime(time: Date): string {
    // ãƒ­ã‚±ãƒ¼ãƒ«ã«å¿œã˜ãŸæ™‚åˆ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  }
}
```

### æ—¥æœ¬èªå¯¾å¿œã®è€ƒæ…®äº‹é …
- **è‡ªç„¶è¨€èªå‡¦ç†**: æ—¥æœ¬èªã®ã‚¿ã‚¹ã‚¯åˆ†æã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
- **æ—¥ä»˜æ™‚åˆ»**: æ—¥æœ¬ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¨ç¥æ—¥å¯¾å¿œ
- **æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: UTF-8ã§ã®é©åˆ‡ãªæ–‡å­—å‡¦ç†

## æ‹¡å¼µæ€§ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```typescript
interface AnalysisPlugin {
  name: string;
  version: string;
  analyze(task: Task, context: AnalysisContext): Promise<AnalysisResult>;
}

class PluginManager {
  private plugins: Map<string, AnalysisPlugin> = new Map();
  
  register(plugin: AnalysisPlugin): void {
    this.plugins.set(plugin.name, plugin);
  }
  
  async runPlugins(task: Task, context: AnalysisContext): Promise<AnalysisResult[]> {
    const results = await Promise.all(
      Array.from(this.plugins.values()).map(plugin => 
        plugin.analyze(task, context)
      )
    );
    return results;
  }
}
```

### è¨­å®šã®é€²åŒ–å¯¾å¿œ

```typescript
class ConfigMigrator {
  private migrations: Map<string, (config: any) => any> = new Map();
  
  migrate(config: any, fromVersion: string, toVersion: string): any {
    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³é–“ã®è¨­å®šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  }
  
  addMigration(version: string, migrationFn: (config: any) => any): void {
    this.migrations.set(version, migrationFn);
  }
}
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€è¦ä»¶ã§å®šç¾©ã•ã‚ŒãŸã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€å°†æ¥ã®æ‹¡å¼µã«ã‚‚å¯¾å¿œã§ãã‚‹æŸ”è»Ÿã§ä¿å®ˆæ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚