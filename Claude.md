# sage (賢者) - AIタスク管理アシスタント 実装ガイド

## プロジェクト概要

このプロジェクトは、Claude DesktopとClaude Code向けのMCPサーバーとして動作するAIタスク管理アシスタント「sage」の実装です。

## 重要なファイル

実装を開始する前に、以下の3つのspec文書を必ず参照してください：

### 📋 要件文書
**ファイル:** `.kiro/specs/claude-task-manager/requirements.md`

- 11の主要要件をEARS形式で定義
- 各要件にはユーザーストーリーと受け入れ基準が含まれています
- 実装時は必ず対応する要件番号を確認してください

### 🏗️ デザイン文書  
**ファイル:** `.kiro/specs/claude-task-manager/design.md`

- システムアーキテクチャと技術設計
- コンポーネント設計とインターフェース定義
- データモデル、エラーハンドリング、セキュリティ考慮事項
- 実装の詳細な技術仕様が記載されています

### ✅ 実装計画
**ファイル:** `.kiro/specs/claude-task-manager/tasks.md`

- 18の主要タスクと詳細サブタスク
- 各タスクは実装可能な単位に分割済み
- 要件への参照が含まれています
- **このファイルの順序に従って実装を進めてください**

## 実装指示

### 🚀 開始方法

1. **最初に必ず上記3つのファイルを読み込んでください**
2. **タスク1から順番に実装を開始してください**
3. **各タスクの要件参照を確認し、要件文書で詳細を確認してください**
4. **技術的な詳細はデザイン文書を参照してください**

### 📝 実装時の注意事項

#### 必須の参照順序
```
1. tasks.md で現在のタスクを確認
2. requirements.md で該当要件の詳細を確認  
3. design.md で技術仕様を確認
4. 実装開始
```

#### コード品質要件
- **TypeScript**を使用してください
- **MCP SDK** (`@modelcontextprotocol/sdk`) を使用してください
- **エラーハンドリング**を適切に実装してください
- **ユニットテスト**を含めてください

#### 外部統合
- **Apple Reminders**: `node-applescript`を使用
- **Notion API**: `@notionhq/client`を使用  
- **Google Calendar**: `googleapis`を使用

### 🎯 推奨実装順序

**Phase 1: 基盤構築**
- タスク1: プロジェクト基盤とMCPサーバー基本構造
- タスク2: 設定管理システム
- タスク3: セットアップウィザード

**Phase 2: コア機能**
- タスク4: タスク分割エンジン
- タスク5: 優先度判定エンジン
- タスク6: 時間見積もりシステム
- タスク7: 関係者抽出システム
- タスク8: タスク分析統合システム

**Phase 3: 外部統合**
- タスク9: Apple Reminders統合
- タスク10: Notion統合
- タスク11: Google Calendar統合
- タスク12: リマインド管理システム
- タスク13: sync_to_notionツール

**Phase 4: 完成**
- タスク14: 設定更新システム
- タスク15: エラーハンドリング
- タスク16: クロスプラットフォーム対応
- タスク17: テストスイート
- タスク18: ドキュメントとデプロイメント

### 🔧 技術スタック

```json
{
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.4",
    "@notionhq/client": "^2.2.15",
    "googleapis": "^144.0.0",
    "node-applescript": "^5.0.0"
  },
  "devDependencies": {
    "typescript": "^5.6.0",
    "@types/node": "^20.0.0",
    "tsx": "^4.19.0",
    "jest": "^29.0.0",
    "@anthropic-ai/mcpb": "^0.1.0"
  }
}
```

### 📁 推奨プロジェクト構造

```
sage/
├── src/
│   ├── index.ts                    # MCP Server エントリーポイント
│   ├── config/
│   │   ├── loader.ts               # 設定ファイル読み込み
│   │   ├── validator.ts            # 設定値検証
│   │   └── types.ts                # 設定型定義
│   ├── setup/
│   │   ├── check-status.ts         # セットアップ状態確認
│   │   ├── wizard.ts               # セットアップウィザード
│   │   └── questions.ts            # 質問定義
│   ├── tools/
│   │   ├── analyze-tasks.ts        # タスク分析
│   │   ├── set-reminders.ts        # リマインド設定
│   │   ├── calendar-check.ts       # カレンダー空き時間
│   │   └── notion-sync.ts          # Notion同期
│   ├── integrations/
│   │   ├── apple-reminders.ts      # Apple Reminders連携
│   │   ├── notion.ts               # Notion API
│   │   └── google-calendar.ts      # Google Calendar API
│   ├── utils/
│   │   ├── priority.ts             # 優先度判定ロジック
│   │   ├── estimation.ts           # 所要時間見積もり
│   │   ├── stakeholders.ts         # 関係者抽出
│   │   └── datetime.ts             # 日時処理
│   └── types/
│       ├── task.ts                 # タスク型定義
│       └── config.ts               # 設定型定義
├── tests/
├── manifest.json                   # Desktop用 MCPB manifest
├── package.json
├── tsconfig.json
└── README.md
```

### 🎯 成功基準

各フェーズ完了時に以下を確認してください：

**Phase 1完了基準:**
- [ ] MCPサーバーが起動する
- [ ] セットアップウィザードが動作する
- [ ] 設定ファイルが正しく生成される

**Phase 2完了基準:**
- [ ] タスク分析が動作する
- [ ] 優先度判定が正しく機能する
- [ ] 時間見積もりが妥当な値を返す

**Phase 3完了基準:**
- [ ] Apple Remindersにタスクが作成される
- [ ] Notionにページが作成される
- [ ] カレンダーから空き時間が検出される

**Phase 4完了基準:**
- [ ] 全機能が統合されて動作する
- [ ] エラーハンドリングが適切に機能する
- [ ] テストが全て通る

### 💡 実装のコツ

1. **段階的実装**: 一度に全てを実装せず、タスク単位で進める
2. **テスト駆動**: 各機能にユニットテストを書く
3. **エラーファースト**: エラーハンドリングを最初から考慮する
4. **設定ファースト**: ハードコードせず、設定ファイルを活用する
5. **ログ出力**: デバッグ用のログを適切に出力する

### 🚨 重要な注意事項

- **APIキー**: 環境変数で管理し、ログに出力しない
- **ファイルパス**: `~/.sage/config.json`を使用
- **エラーメッセージ**: ユーザーフレンドリーな日本語メッセージ
- **タイムゾーン**: 日本時間 (Asia/Tokyo) を考慮
- **文字エンコーディング**: UTF-8で適切に処理

## 質問やサポートが必要な場合

実装中に不明な点があれば、以下を明確にして質問してください：

1. **現在実装中のタスク番号**
2. **参照している要件番号**
3. **具体的な技術的課題**
4. **期待する動作と実際の動作**

このガイドに従って実装を進めることで、要件を満たす高品質なsageシステムを構築できます。

---

**実装開始**: tasks.mdのタスク1から開始してください！